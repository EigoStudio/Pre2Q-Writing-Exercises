<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è‹±æ¤œæº–2ç´š ä¸¦ã¹æ›¿ãˆå•é¡Œã€€å‹•åè©ã¨ä¸å®šè©</title>
<style>
  body {
    font-family: "Helvetica Neue", Arial, sans-serif;
    background-color: #f0f4f8;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    color: #333;
  }
  h2 {
    color: #2c3e50;
    margin-bottom: 10px;
  }
  .container {
    background: white;
    max-width: 600px;
    width: 100%;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    text-align: center;
  }
  .question-box {
    font-size: 1.2rem;
    font-weight: bold;
    margin-bottom: 20px;
    min-height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #eef2f5;
    border-radius: 10px;
    padding: 10px;
    border-left: 5px solid #3498db;
  }
  .answer-area {
    min-height: 60px;
    border-bottom: 2px solid #bdc3c7;
    margin-bottom: 20px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 8px;
    padding: 10px;
  }
  .word-bank {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
  }
  .word-btn {
    background-color: #3498db;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 20px;
    font-size: 1rem;
    cursor: pointer;
    transition: transform 0.1s, background-color 0.2s;
    user-select: none;
  }
  .word-btn:active {
    transform: scale(0.95);
  }
  .word-btn.used {
    background-color: #bdc3c7;
    color: #ecf0f1;
    cursor: default;
    pointer-events: none;
  }
  .answer-word {
    background-color: #e67e22;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 8px;
    font-size: 1rem;
    cursor: pointer;
    animation: popIn 0.2s ease;
  }
  @keyframes popIn {
    0% { transform: scale(0.5); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
  }
  .controls {
    margin-top: 20px;
  }
  button.action-btn {
    padding: 12px 30px;
    font-size: 1.1rem;
    background-color: #27ae60;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }
  button.action-btn:hover {
    background-color: #219150;
  }
  .result-msg {
    margin-top: 15px;
    font-weight: bold;
    font-size: 1.2rem;
    height: 30px;
  }
  .correct { color: #27ae60; }
  .wrong { color: #c0392b; }
  
  /* Progress Bar */
  .progress-container {
    width: 100%;
    background-color: #e0e0e0;
    border-radius: 10px;
    margin-bottom: 20px;
    height: 10px;
  }
  .progress-bar {
    height: 100%;
    background-color: #3498db;
    border-radius: 10px;
    width: 0%;
    transition: width 0.3s;
  }
</style>
</head>
<body>

<h2>School Life Writing</h2>

<div class="container">
  <div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <div class="question-box" id="questionText">
    ã“ã“ã«æ—¥æœ¬èªãŒè¡¨ç¤ºã•ã‚Œã¾ã™
  </div>

  <div class="answer-area" id="answerArea">
    <span style="color:#aaa; font-size:0.9rem; align-self:center;">å˜èªã‚’ã‚¿ãƒƒãƒ—ã—ã¦ä¸¦ã¹ã¦ãã ã•ã„</span>
  </div>

  <div class="word-bank" id="wordBank">
    </div>

  <div class="result-msg" id="resultMsg"></div>

  <div class="controls">
    <button class="action-btn" id="checkBtn" onclick="checkAnswer()">Check Answer</button>
    <button class="action-btn" id="nextBtn" onclick="nextQuestion()" style="display:none; background-color: #2980b9;">Next Question</button>
  </div>
</div>

<script>
  // å•é¡Œãƒ‡ãƒ¼ã‚¿ï¼ˆ10å•ï¼‰
  const quizData = [
    { ja: "æ ¡å‰‡ã‚’å®ˆã‚‹ã“ã¨ã¯ç”Ÿå¾’ã«ã¨ã£ã¦å¤§åˆ‡ã§ã™ã€‚", en: "It is important for students to follow school rules." },
    { ja: "è‹±èªã‚’å­¦ã¶ã“ã¨ã¯å°†æ¥ã®ãŸã‚ã«å½¹ã«ç«‹ã¡ã¾ã™ã€‚", en: "Learning English is useful for our future." },
    { ja: "ç§ãŸã¡ã¯æœ¬ã‚’èª­ã‚€ãŸã‚ã«å›³æ›¸å®¤ã¸è¡Œãã¾ã—ãŸã€‚", en: "We went to the library to read books." },
    { ja: "ç§ã®å‹é”ã¯å­¦æ ¡ã§ç§ã‚’å¹¸ã›ã«ã—ã¦ãã‚Œã¾ã™ã€‚", en: "My friends make me happy at school." },
    { ja: "ã‚¯ãƒ©ã‚¹ãƒ¡ãƒ¼ãƒˆã¨ä¸€ç·’ã«ã‚¹ãƒãƒ¼ãƒ„ã‚’ã™ã‚‹ã®ã¯æ¥½ã—ã„ã§ã™ã€‚", en: "It is fun to play sports with classmates." },
    { ja: "éƒ¨æ´»ã«å…¥ã‚‹ã“ã¨ã¯ç´ æ™´ã‚‰ã—ã„çµŒé¨“ã§ã™ã€‚", en: "Joining a school club is a great experience." },
    { ja: "ç”Ÿå¾’ãŸã¡ã¯è‰¯ã„æˆç¸¾ã‚’ã¨ã‚‹ãŸã‚ã«ä¸€ç”Ÿæ‡¸å‘½å‹‰å¼·ã—ã¾ã™ã€‚", en: "Students study hard to get good grades." },
    { ja: "ãã®é•·ã„ã‚¹ãƒ”ãƒ¼ãƒã¯ç”Ÿå¾’ãŸã¡ã‚’ç–²ã‚Œã•ã›ã¾ã—ãŸã€‚", en: "The long speech made the students tired." },
    { ja: "ãŠæ˜¼ã”é£¯ã‚’ä¸€ç·’ã«é£Ÿã¹ã‚‹ã“ã¨ã¯æ¥½ã—ã„ã§ã™ã€‚", en: "Eating lunch together is enjoyable." },
    { ja: "æ¯æœæ—©ãèµ·ãã‚‹ã“ã¨ã¯ç§ã«ã¨ã£ã¦é›£ã—ã„ã§ã™ã€‚", en: "It is difficult for me to get up early every morning." }
  ];

  let currentQuestionIndex = 0;
  let currentWords = []; // ç¾åœ¨ã®å•é¡Œã®å˜èªãƒªã‚¹ãƒˆï¼ˆã‚·ãƒ£ãƒƒãƒ•ãƒ«æ¸ˆã¿ï¼‰
  let userSelection = []; // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸ã‚“ã å˜èªï¼ˆé †åºä¿æŒï¼‰

  const questionText = document.getElementById('questionText');
  const answerArea = document.getElementById('answerArea');
  const wordBank = document.getElementById('wordBank');
  const resultMsg = document.getElementById('resultMsg');
  const checkBtn = document.getElementById('checkBtn');
  const nextBtn = document.getElementById('nextBtn');
  const progressBar = document.getElementById('progressBar');

  // ã‚¢ãƒ—ãƒªåˆæœŸåŒ–
  function initGame() {
    currentQuestionIndex = 0;
    loadQuestion();
  }

  // é…åˆ—ã‚·ãƒ£ãƒƒãƒ•ãƒ«é–¢æ•°
  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  // å•é¡Œèª­ã¿è¾¼ã¿
  function loadQuestion() {
    if (currentQuestionIndex >= quizData.length) {
      finishGame();
      return;
    }

    // UIãƒªã‚»ãƒƒãƒˆ
    userSelection = [];
    resultMsg.textContent = "";
    resultMsg.className = "result-msg";
    checkBtn.style.display = "inline-block";
    nextBtn.style.display = "none";
    
    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ›´æ–°
    const progress = (currentQuestionIndex / quizData.length) * 100;
    progressBar.style.width = progress + "%";

    // å•é¡Œæ–‡ã‚»ãƒƒãƒˆ
    const q = quizData[currentQuestionIndex];
    questionText.textContent = q.ja;

    // å˜èªã‚’åˆ†è§£ã—ã¦ã‚·ãƒ£ãƒƒãƒ•ãƒ«
    // ãƒ”ãƒªã‚ªãƒ‰ã‚„ã‚¯ã‚¨ã‚¹ãƒãƒ§ãƒ³ãƒãƒ¼ã‚¯ã‚’åˆ†é›¢ã—ã¦å˜èªæ‰±ã„ã«ã™ã‚‹å‡¦ç†
    let cleanEn = q.en.replace(/([.,?])/g, " $1"); 
    let words = cleanEn.split(/\s+/).filter(w => w.length > 0);
    currentWords = shuffle([...words]);

    renderWordBank();
    renderAnswerArea();
  }

  // å˜èªãƒãƒ³ã‚¯ã®æç”»
  function renderWordBank() {
    wordBank.innerHTML = "";
    currentWords.forEach((word, index) => {
      const btn = document.createElement('button');
      btn.className = "word-btn";
      btn.textContent = word;
      
      // ã™ã§ã«é¸ã°ã‚Œã¦ã„ã‚‹å˜èªï¼ˆåŒã˜å˜èªãŒè¤‡æ•°ã‚ã‚‹å ´åˆã®å‡¦ç†ã®ãŸã‚ã€IDã§ã¯ãªãã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç®¡ç†æ¨å¥¨ã ãŒã€
      // ç°¡æ˜“ç‰ˆã¨ã—ã¦ã€Œä½¿ç”¨æ¸ˆã¿ã‚«ã‚¦ãƒ³ãƒˆã€ãƒ­ã‚¸ãƒƒã‚¯ã§åˆ¶å¾¡ï¼‰
      const usedCount = userSelection.filter(w => w.text === word).length;
      const totalCount = currentWords.filter(w => w === word).length;
      
      // ã“ã®å˜èªãŒã¾ã ä½¿ãˆã‚‹ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆå˜ç´”åŒ–ã®ãŸã‚ã€é…åˆ—å†…ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯IDã§ç®¡ç†ï¼‰
      btn.onclick = () => selectWord(word, index);
      
      // ã™ã§ã«é¸æŠæ¸ˆã¿ãªã‚‰ç„¡åŠ¹åŒ–ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆå³å¯†ã«ã¯indexç®¡ç†ãŒå¿…è¦ï¼‰
      // ä»Šå›ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ã€Œé¸ã‚“ã ã‚‰æ¶ˆãˆã‚‹ã€ãƒ­ã‚¸ãƒƒã‚¯ã‚’renderAnswerAreaå´ã‹ã‚‰åˆ¶å¾¡
      if (userSelection.some(obj => obj.originalIndex === index)) {
        btn.classList.add('used');
      }

      wordBank.appendChild(btn);
    });
  }

  // å›ç­”ã‚¨ãƒªã‚¢ã®æç”»
  function renderAnswerArea() {
    answerArea.innerHTML = "";
    if (userSelection.length === 0) {
      answerArea.innerHTML = '<span style="color:#aaa; font-size:0.9rem; align-self:center;">å˜èªã‚’ã‚¿ãƒƒãƒ—ã—ã¦ä¸¦ã¹ã¦ãã ã•ã„</span>';
      return;
    }

    userSelection.forEach((item, idx) => {
      const btn = document.createElement('button');
      btn.className = "answer-word";
      btn.textContent = item.text;
      btn.onclick = () => removeWord(idx); // ã‚¿ãƒƒãƒ—ã§ãƒãƒ³ã‚¯ã«æˆ»ã™
      answerArea.appendChild(btn);
    });
  }

  // å˜èªé¸æŠ
  function selectWord(word, originalIndex) {
    userSelection.push({ text: word, originalIndex: originalIndex });
    renderWordBank();
    renderAnswerArea();
  }

  // å˜èªã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼ˆãƒãƒ³ã‚¯ã«æˆ»ã™ï¼‰
  function removeWord(selectionIndex) {
    userSelection.splice(selectionIndex, 1);
    renderWordBank();
    renderAnswerArea();
  }

  // ç­”ãˆåˆã‚ã›
  function checkAnswer() {
    const userAnswer = userSelection.map(obj => obj.text).join(" ");
    // å…ƒã®æ–‡ï¼ˆãƒ”ãƒªã‚ªãƒ‰ç­‰ã®ã‚¹ãƒšãƒ¼ã‚¹èª¿æ•´ï¼‰ã¨æ¯”è¼ƒ
    // ç°¡æ˜“çš„ã«ã€è¨˜å·ã®å‰ã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¦æ¯”è¼ƒ
    const formattedUserAnswer = userAnswer.replace(/\s+([.,?])/g, "$1");
    const correctAnswer = quizData[currentQuestionIndex].en;

    if (formattedUserAnswer === correctAnswer) {
      resultMsg.textContent = "Great! æ­£è§£ã§ã™ï¼";
      resultMsg.classList.add("correct");
      checkBtn.style.display = "none";
      nextBtn.style.display = "inline-block";
    } else {
      resultMsg.textContent = "Try again! æƒœã—ã„ï¼";
      resultMsg.classList.add("wrong");
    }
  }

  // æ¬¡ã®å•é¡Œã¸
  function nextQuestion() {
    currentQuestionIndex++;
    loadQuestion();
  }

  // ã‚²ãƒ¼ãƒ çµ‚äº†
  function finishGame() {
    questionText.textContent = "Congratulations! å…¨å•ã‚¯ãƒªã‚¢ã§ã™ï¼";
    answerArea.innerHTML = "ğŸ‰";
    wordBank.innerHTML = "";
    resultMsg.textContent = "";
    checkBtn.style.display = "none";
    nextBtn.style.display = "none";
    progressBar.style.width = "100%";
  }

  // é–‹å§‹
  initGame();
</script>

</body>
</html>
